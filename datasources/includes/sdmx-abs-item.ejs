// Pass optionally
// outerGroups: An optional array of group names into which this item should be placed, eg. ["National Datasets", "Social and Economic"].
// group:       The group name to include this in, eg. "Person".
// subgroup:    An optional subgroup name, eg. "Education".
// name:        The name of the item, eg. "Number of Motor Vehicles".
// bys:         A string with the "by" variables, eg. "By Age by Sex".
// id:          The dataset id for the item, eg. "ABS_CENSUS2011_B29".
// subId:       In case some dataset ids are repeated (eg. to show different aspects of a dataset), you must use different subId to distinguish them.
// geoType:     One of "SAx" (for SA1-4 datasets), "LGA2011" (for LGA_2011 datasets), "SA1_SA" (for South Aust SA1 datasets), or "FED".
// hasState:    Do we need to aggregate over the unnecessary STATE dimension?
// singleValuedDimensionIds: An array of dimensions which can only take a single value, eg. ["SPC"].
// sexId:       The sex dimension id - usually "MEASURE". Pass "" if none.
// ageId:       The age dimension id - usually "AGE" (eg. ABS_CENSUS2011_B45 puts AGE in MEASURE, sex in SEX). Pass "" if none.
// regionDimensionId: Required if the dimension id is not REGION, Eg. "ASGS_2011".
// regionType:  The region type, eg. "aus".
// series:      Either "B" or "T" if this is B- or T- series Census data.
// canNotDisplayPercent:  If true, sets canDisplayPercent=false (done backwards because the default is true).
// measureWhitelist: Eg. Labour Force MEASURE has invalid entries such as "M" for "Migration:".
// measureTotalValueIds: Additional total fields in the MEASURE dimension, eg. for Census B12, "8" is Total dependent children.
// measureSelectedInitially: Which values of MEASURE are selectedInitially.
// blacklist:   A custom blacklist, as an object whose keys are dimension ids, and values are arrays of blacklisted values.
// nameOutsideCatalog: Optional value for the name of the item outside the catalog, if different.
// description: An additional description placed at the front of the description generated by sdmx-abs-description.ejs.
//
{
    <% if (outerGroups) { %>  // Place this item inside the catalog hierarchy somewhere.
        <% for(var i=0; i < outerGroups.length; i++) { %>
            "name": "<%= outerGroups[i] %>",
            "type": "group",
            "items": [{
        <% } %>
    <% } %>
    <% if (series) { %> // If "series" is not null, put this in a top-level Census directory.
    "name": "Census",
    "type": "group",
    "isOpen": false,
    "items": [{
    <% } %>
    <% if (group) { %> // If "group" is not null, put it in a group with that name.
    "name": "<%= group %>",
    "type": "group",
    "isOpen": false,
    "items": [
        {
    <% } %>
            <% if (subgroup) { %> // If "subgroup" is not null, add another grouping level above "name"
                "name": "<%= subgroup %>",
                "type": "group",
                "isOpen": false,
                "items": [{
            <% } %>
            <% if (!bys && !series && nameOutsideCatalog) { %>
                "name": "<%= nameOutsideCatalog %>",
                "nameInCatalog": "<%= name %>",
            <% } else { %>
                "name": "<%= name %>",
            <% } %>
            <% if (bys) { %> // If "bys" is not null, add another grouping level under "name"
                "type": "group",
                "isOpen": false,
                "items": [{
            <% } %>
            <% if (series) { %> // If it is a B or T series, add 2 grouping levels under "name" (for B/T and for LGA/SAx/SA_SA1s)
                <% if (bys) { %> // "bys" didnt put the name in yet, because it depends on series.
                    "name": "<%= bys %>",
                <% } %>
                "type": "group",
                "items": [{
                    "name": <%- include("sdmx-abs-BT-name", {"series": series}) %>,
                    "type": "group",
                    "items": [{
                        "nameInCatalog": <%- include("sdmx-abs-geo-name", {"geoType": geoType}) %>,
                        <% if (nameOutsideCatalog) { %>
                            "name": "<%= nameOutsideCatalog %>",
                        <% } else { %>
                            "name": "<%= name %>",
                        <% } %>
            <% } else { %>
                <% if (bys) { %> // "bys" didnt put the name in yet, because it depends on series.
                    "nameInCatalog": "<%= bys %>",
                    <% if (nameOutsideCatalog) { %>
                        "name": "<%= nameOutsideCatalog %>",
                    <% } else { %>
                        "name": "<%= name %>",
                    <% } %>
                <% } %>
            <% } %>
            "type": "sdmx-json",
            "id": "ABS_SDMX-JSON_<%= subId %>_<%= id %>", // Give this a unique id so we can move it around in the catalog in subsequent versions and always find it.
            "rectangle": [109, -45, 158, -8],
            "cacheDuration": "300s", // Cache data for 5 minutes.
            <% if (regionNameTemplate) { %>
                "regionNameTemplate": "<%= regionNameTemplate %>",
            <% } %>
            "sortValues": "id",
            "showWarnings": false, // Eg. many of the DEATHS datasets include 0 or 50 in the list of state codes; do not raise a warning to user.
            "cleanFootnotes": true,
            "forceShowDimensionIds": ["MEASURE"],
            "url": "http://stat.data.abs.gov.au/sdmx-json/data/<%= id %>",
            "description": <%- include("sdmx-abs-description", {"description": description, "id": id}) %>,
            <% if (hasState) { %>
               "aggregatedDimensionIds": ["STATE"],
            <% } %>
            <% if (canNotDisplayPercent) { %>
                "canDisplayPercent": false,
            <% } %>
            <% if (singleValuedDimensionIds) { %>
                "singleValuedDimensionIds": <%- JSON.stringify(singleValuedDimensionIds) %>,
            <% } %>
            "totalValueIds": {
                "*": ["TOT", "LFTOT"],  // The dataflow for "COB" shows "TOTAL", but it isnt available in the data.
                <% if (sexId) { %>
                    "<%= sexId %>": ["3"],
                <% } %>
                <% if (ageId) { %>
                    "<%= ageId %>": ["TT", "O15"],
                <% } %>
                <% if (measureTotalValueIds) { %>
                    "MEASURE": <%- JSON.stringify(measureTotalValueIds) %>,
                <% } %>
                "SPC": ["TT"],
                "MTWP": ["1M", "2M", "3M"],
                "FMCF": ["CF", "1", "2", "3"],
                "POUR": ["TOT", "1", "2", "2_0", "2_11"],
                "UAI1P": ["TOT", "2", "2_S", "2_D"],
                "LFSP": ["TOT", "EMP", "UEMP"],
                "FAMILY_TYPE": ["6"], // ABS_FAMILY_PROJ
                "HH_TYPE": ["4"], // ABS_HH_PROV
                "LEN": ["99"], // HF, Household finance (lenders)
                "INFANT_AGE": ["IMTOT"],  // Infant ages, INFANTDEATHS_YEAROCCURENCE and INFANTDEATHS_REGISTRATIONYEAR
                "DLC_11NC": ["210", "205"],  // For ABS_LAND_COVER
                "DLC_11": ["T"], // For ABS_PHYSICAL_ACCOUNT_LC
                "ANZIC": ["01", "TOTAL"],  // For ABS_LAMPS
                "LU_11NC": ["210", "205"],  // 210, 205 are for ABS_LAND_USE
                "LU_11": ["T"],  // ABS_MONETARY_ACCOUNT, ABS_PHYSICAL_ACCOUNT_LU uses T for total.
                "LENDER": ["99"], // For LENDING_INDUSTRY and LENDING_BY_PURPOSE
                "INDUSTRY": ["-1", "T", "-"],  // T for LENDING_INDUSTRY, "-" for LABOUR_PRICE_INDEX (which fortunately has no T), "-1" for MERCH_EXP/IMP. MERCH_IMP/EXP also has A-T subtotals, which we put in a blacklist.
                // "PURPOSE": ["TOTAL_CF"],  // For LENDING_BY_PURPOSE (not included)
                "SITC_REV3": ["-1", "0", "1", "2", "3", "4", "5", "6", "7", "8", "9"],  // For MERCH_EXP, MERCH_IMP
                "COUNTRY": ["-"],  // For MERCH_EXP
                "STRD_BEDRD": ["._TOT"],  // For ABS_CENSUS2011_T16
                "FMCF_INCC": ["TOT_TOT"], // For ABS_CENSUS2011_T26
                "DEPOSIT_TYPE": ["6"], // For MINING_EXPLORATION
                "MINERAL_TYPE": ["11"], // For MINING_EXPLORATION
                "MLU_0611": ["9"], // For ABS_MONETARY_ACCOUNT ("Closing stock 2011")
                "PLU_0611": ["10"], // For ABS_PHYSICAL_ACCOUNT_LU (closing stock 2011)
                "PLC_0611": ["10"], // For ABS_PHYSICAL_ACCOUNT_LC (closing stock 2011)
                "PERSON_LA": ["16"], // For ABS_PERSONS_PROJ
                "LEASE_TYPE": ["3"], // For PETROLEUM_EXPLORATION
                "ASSET": ["999"], // For CAPEX
                "SECTOR": ["7", "9"],  // 7 for LABOUR_PRICE_INDEX, 9 for ABS_BA_SA2_ASGS2016 - luckily 9, 7 not present in each others.
                "VEHICLE": ["900"], // For NEWMVSALES
                "IND_R": ["20"],  // For RT (Retail Trade)
                "RELP": ["2"], // For ABS_CENSUS2011_B14 and T12, Religious Affiliation.
                "ANCP": ["TOTP"], // For ABS_CENSUS2011_T09 and ABS_CENSUS2011_B08
                "LANP": ["LOTE", "71", "52", "41", "65"], // For ABS_CENSUS2011_B13 and ABS_CENSUS2011_T10
                "ENGLP": ["OTH", "SOL"],  // For ABS_CENSUS2011_B11, B12. Note T11 uses "SOL" in the MEASURE dim.
                "WORK": ["9"],  // For ABS_BA_SA2_ASGS2016.  Actually only WORK=9 works.
                "TYPE_WORK": ["9"],  // For ABS_BLDG_APPROVALS_LGA2016 and ABS_BLDG_APPROVALS_LGA2017
                "BUILDING_TYPE": ["999", "100", "200", "300", "400", "700", "800"],  // For ABS_BA_SA2_ASGS2016
                "TYPE_BLDG": ["999", "100", "200", "300", "400", "700", "800"],  // For ABS_BLDG_APPROVALS_LGA2016 and ABS_BLDG_APPROVALS_LGA2017
                "PLURALITY": ["SX_6"],  // For CONFINEMENTS_PLURALITY
            },
            <% if (blacklist) { %>
                // Include a custom blacklist.
                "blacklist": <%- JSON.stringify(blacklist) %>,
            <% } %>
            "whitelist": {
                <% if (geoType && geoType.indexOf("LGA")===0) { %>
                    "REGIONTYPE": ["<%= geoType %>"],
                <% } %>
                <% if (measureWhitelist) { %>
                    "MEASURE": <%- JSON.stringify(measureWhitelist) %>,
                <% } %>
                "FMCF": ["TOT", "[1-3]", "9"],  // For B25 and T25. A hack to hide the detailed hierarchy, since we cannot cope with that yet.
                "STRD": ["TOT", "OPD", "[1-3]", "9", "11", "Z", "UPD"], // For B31-36 and T15-18. Hack as above. Note for B36 this is in MEASURE. Note T15 uses 11 for separate house, 1 has no data.
                "LFSP": ["TOT", "EMP", "[1-4]", "7", "Z", "UEMP"], // For B42. Hack to suppress some of the hierarchy.
                "MTWP": ["TOT", "[1-3]M", "00[1-9]", "010", "011", "232", "TA", "BA", "B2", "233", "234", "Z"], // For B45. Hack to suppress some of the hierarchy.
                "TYPP": ["TOT", "10", "2", "3", "40", "50", "60", "Z", "V"], // For B15 and T13. Suppress some of the hierarchy.
                "FMCF_INCC": [".*_.*"], // For T26. Only values containing an underscore have data.
                "IND": ["-"], // For CAPEX. No sub-industries have data by state.
                "ANCP_2016": ["TOT", "[0-9]{4}"], // For ABS_C16_T05_LGA/SA, only TOT and 4-digit children codes have valid data.
                "BPLP_2016": ["TOT", "[0-9]{4}"], // For ABS_C16_T06,7_LGA/SA, only TOT and 4-digit children codes have valid data.
                "RELP_2016": ["TOT", "[0-9]{4}"], // For ABS_C16_T10_LGA/SA, only TOT and 4-digit children codes have valid data.
                "LANP_2016": ["TOT", "[0-9]{4}"], // For ABS_C16_T09_LGA/SA, only TOT and 4-digit children codes have valid data.
                "FMCF_2016": ["TOT", "[0-9]{4}"], // For ABS_C16_T19_LGA/SA, as above. Note a different set have values to FMCF itself.
                "HHCD_2016": ["TOT", "[0-9]{3}"], // For ABS_C16_T21_LGA/SA and ABS_C16_T23_LGA/SA, only the third (lowest) level has data.
                "<%= ageId %>": ["A[0-9]+", "T.*", "O.*"], // Only shows five-year ranges and totals, not individual years.
                "BUILDING_TYPE": ["999", "100", "110", "700", "800", "850"],  // For ABS_BA_SA2_ASGS2016
                "TYPE_BLDG": ["999", "100", "110", "700", "800", "850"],  // For ABS_BLDG_APPROVALS_LGA2016 and ABS_BLDG_APPROVALS_LGA2017
            },
            <% if (regionDimensionId) { %>
                "regionDimensionId": "<%= regionDimensionId %>",
            <% } %>
            <% if (regionType) { %>
                "regionType": "<%= regionType %>",
            <% } %>
            "selectedInitially": {
                // This first if is probably redundant, since the whitelist only lets LGAxxxx through.
                <% if (geoType && geoType.indexOf("LGA")===0) { %>
                    "REGIONTYPE": ["<%= geoType %>"],
                <% } %>
                <% if (geoType=="SAx") { %>
                    "REGIONTYPE": ["SA4"],
                <% } %>
                <% if (geoType=="FED") { %>
                    "REGIONTYPE": ["FED"],
                <% } %>
                <% if (measureSelectedInitially) { %>
                    "MEASURE": <%- JSON.stringify(measureSelectedInitially) %>,
                <% } %>
                "COB": ["1101"], // Start with Australia. There is no working total value.
                "DT": ["2"], // for series HF and RT, start with a $ amount (was "5" but that breaks RT).
                "RESPONSE_CAT": ["RESPCLR_Y"],  // for AMLPS_RESP_2017
                "STATE": ["1", "2", "3", "4", "5", "6", "7", "8"], // In the rare case where STATE is not aggregated over (eg. ABS_DEM_QIM), start with all selected.
                "ASGS_2011": ["1", "2", "3", "4", "5", "6", "7", "8"] // In the rare case where ASGS_2011 is not shown as a region (eg. ABS_DEM_QIM), start with all selected.
            }
            <% if (series) { %> // If "series" is not null, close the extra 2 grouping levels
            }] }]
            <% } %>
            <% if (bys) { %> // If "bys" is not null, close the extra grouping level
            }]
            <% } %>
            <% if (subgroup) { %> // If "subgroup" is not null, close the extra grouping levels
            }]
            <% } %>
    <% if (group) { %> // If "group" is not null, close the group.
        }
    ]
    <% } %>
    <% if (series) { %> // If "series" is not null, close the extra top-level grouping level
    }]
    <% } %>
    <% if (outerGroups) { %>  // Close all the outer groups.
        <% for(var i=0; i < outerGroups.length; i++) { %>
            }]
        <% } %>
    <% } %>
}
