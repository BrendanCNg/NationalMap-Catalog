// Pass optionally
// group:    The group name to include this in, eg. "Person".
// subgroup: An optional subgroup name, eg. "Education".
// name:     The name of the item, eg. "Number of Motor Vehicles".
// bys:      A string with the "by" variables, eg. "By Age by Sex".
// id:       The dataset id for the item, eg. "ABS_CENSUS2011_B29".
// subId:    In case some dataset ids are repeated (eg. to show different aspects of a dataset), you must use different subId to distinguish them.
// geoType:  One of "SAx" (for SA1-4 datasets), "LGA2011" (for LGA_2011 datasets), "SA1_SA" (for South Aust SA1 datasets).
// hasState: Do we need to aggregate over the unnecessary STATE dimension?
// singleValuedDimensionIds: An array of dimensions which can only take a single value, eg. ["SPC"].
// sexId:    The sex dimension id - usually "MEASURE". Pass "" if none.
// ageId:    The age dimension id - usually "AGE" (eg. ABS_CENSUS2011_B45 puts AGE in MEASURE, sex in SEX). Pass "" if none.
// regionDimensionId: Required if the dimension id is not REGION, Eg. "ASGS_2011".
// regionType: The region type, eg. "aus".
// series:     Either "B" or "T" if this is B- or T- series Census data.
// measureWhitelist: Eg. Labour Force MEASURE has invalid entries such as "M" for "Migration:".
// measureTotalValueIds: Additional total fields in the MEASURE dimension, eg. for Census B12, "8" is Total dependent children.
// blacklist: A custom blacklist, as an object whose keys are dimension ids, and values are arrays of blacklisted values.
{
    <% if (series) { %> // If "series" is not null, put this in a top-level Census directory.
    "name": "Census",
    "type": "group",
    "isOpen": true,
    "items": [{
    <% } %>
    "name": "<%= group %>",
    "type": "group",
    "isOpen": false,
    "items": [
        {
            <% if (subgroup) { %> // If "subgroup" is not null, add another grouping level above "name"
                "name": "<%= subgroup %>",
                "type": "group",
                "isOpen": false,
                "items": [{
            <% } %>
            "name": "<%= name %>",
            <% if (bys) { %> // If "bys" is not null, add another grouping level under "name"
                "type": "group",
                "isOpen": false,
                "items": [{
                    "name": "<%= bys %>",
            <% } %>
            <% if (series) { %> // If it is a B or T series, add 2 grouping levels under "name" (for B/T and for LGA/SAx/SA_SA1s)
                "type": "group",
                "items": [{
                    "name": <%- include("sdmx-abs-BT-name", {"series": series}) %>,
                    "type": "group",
                    "items": [{
                        "name": <%- include("sdmx-abs-geo-name", {"geoType": geoType}) %>,
            <% } %>
            "type": "sdmx-json",
            "id": "ABS_SDMX-JSON_<%= subId %>_<%= id %>", // Give this a unique id so we can move it around in the catalog in subsequent versions and always find it.
            "sortValues": "id",
            "showWarnings": false, // Eg. many of the DEATHS datasets include 0 or 50 in the list of state codes; do not raise a warning to user.
            "cleanFootnotes": true,
            "forceShowDimensionIds": ["MEASURE"],
            "url": "http://stat.data.abs.gov.au/sdmx-json/data/<%= id %>",
            "description": <%- include("sdmx-abs-description", {"description": description, "id": id}) %>,
            <% if (hasState) { %>
               "aggregatedDimensionIds": ["STATE"],
            <% } %>
            <% if (singleValuedDimensionIds) { %>
                "singleValuedDimensionIds": <%- JSON.stringify(singleValuedDimensionIds) %>,
            <% } %>
            "totalValueIds": {
                "*": ["TOT", "LFTOT"],  // The dataflow for "COB" shows "TOTAL", but it isnt available in the data.
                <% if (sexId) { %>
                    "<%= sexId %>": ["3"],
                <% } %>
                <% if (ageId) { %>
                    "<%= ageId %>": ["TT", "O15"],
                <% } %>
                <% if (measureTotalValueIds) { %>
                    "MEASURE": <%- JSON.stringify(measureTotalValueIds) %>,
                <% } %>
                "SPC": ["TT"],
                "MTWP": ["1M", "2M", "3M"],
                "FMCF": ["CF", "1", "2", "3"],
                "POUR": ["TOT", "1", "2", "2_0", "2_11"],
                "UAI1P": ["TOT", "2", "2_S", "2_D"],
                "LFSP": ["TOT", "EMP", "UEMP"],
                "FAMILY_TYPE": ["6"], // ABS_FAMILY_PROJ
                "HH_TYPE": ["4"], // ABS_HH_PROV
                "LEN": ["99"], // HF, Household finance (lenders)
                "INFANT_AGE": ["IMTOT"],  // Infant ages, INFANTDEATHS_YEAROCCURENCE and INFANTDEATHS_REGISTRATIONYEAR
                "DLC_11NC": ["210", "205"],  // For ABS_LAND_COVER
                "DLC_11": ["T"], // For ABS_PHYSICAL_ACCOUNT_LC
                "ANZIC": ["TOTAL"],  // For ABS_LAMPS
                "LU_11NC": ["210", "205"],  // 210, 205 are for ABS_LAND_USE
                "LU_11": ["T"],  // ABS_MONETARY_ACCOUNT, ABS_PHYSICAL_ACCOUNT_LU uses T for total.
                "LENDER": ["99"], // For LENDING_INDUSTRY and LENDING_BY_PURPOSE
                "INDUSTRY": ["-1", "T", "-"],  // T for LENDING_INDUSTRY, "-" for LABOUR_PRICE_INDEX (which fortunately has no T), "-1" for MERCH_EXP/IMP. MERCH_... also has T for a subtotal, so put this after -1.
                // "PURPOSE": ["TOTAL_CF"],  // For LENDING_BY_PURPOSE (not included)
                "SITC_REV3": ["-1"],  // For MERCH_EXP
                "COUNTRY": ["-"],  // For MERCH_EXP
                "STRD_BEDRD": ["._TOT"],  // For ABS_CENSUS2011_T16
                "FMCF_INCC": ["TOT_TOT"], // For ABS_CENSUS2011_T26
                "DEPOSIT_TYPE": ["6"], // For MINING_EXPLORATION
                "MINERAL_TYPE": ["11"], // For MINING_EXPLORATION
                "MLU_0611": ["9"], // For ABS_MONETARY_ACCOUNT ("Closing stock 2011")
                "PLU_0611": ["10"], // For ABS_PHYSICAL_ACCOUNT_LU (closing stock 2011)
                "PLC_0611": ["10"], // For ABS_PHYSICAL_ACCOUNT_LC (closing stock 2011)
                "PERSON_LA": ["16"], // For ABS_PERSONS_PROJ
                "LEASE_TYPE": ["3"], // For PETROLEUM_EXPLORATION
                "ASSET": ["999"], // For CAPEX
                "SECTOR": ["7"],  // For LABOUR_PRICE_INDEX
                "VEHICLE": ["900"], // For NEWMVSALES
                "IND_R": ["20"],  // For RT (Retail Trade)
            },
            <% if (blacklist) { %>
                // Include a custom blacklist.
                "blacklist": <%- JSON.stringify(blacklist) %>,
            <% } %>
            "whitelist": {
                <% if (geoType && geoType.indexOf("LGA")===0) { %>
                    "REGIONTYPE": ["<%= geoType %>"],
                <% } %>
                <% if (measureWhitelist) { %>
                    "MEASURE": <%- JSON.stringify(measureWhitelist) %>,
                <% } %>
                "FMCF": ["TOT", "[1-3]", "9"],  // For B25 and T25. A hack to hide the detailed hierarchy, since we cannot cope with that yet.
                "STRD": ["TOT", "OPD", "[1-3]", "9", "11", "Z", "UPD"], // For B31-36 and T15-18. Hack as above. Note for B36 this is in MEASURE. Note T15 uses 11 for separate house, 1 has no data.
                "LFSP": ["TOT", "EMP", "[1-4]", "7", "Z", "UEMP"], // For B42. Hack to suppress some of the hierarchy.
                "MTWP": ["TOT", "[1-3]M", "00[1-9]", "010", "011", "232", "TA", "BA", "B2", "233", "234", "Z"], // For B45. Hack to suppress some of the hierarchy.
                "TYPP": ["TOT", "10", "2", "3", "40", "50", "60", "Z", "V"], // For B15 and T13. Suppress some of the hierarchy.
                "FMCF_INCC": [".*_.*"], // For T26. Only values containing an underscore have data.
                "IND": ["-"], // For CAPEX. No sub-industries have data by state.
                "<%= ageId %>": ["A[0-9]+", "T.*", "O.*"] // Only shows five-year ranges and totals, not individual years.
            },
            <% if (regionDimensionId) { %>
                "regionDimensionId": "<%= regionDimensionId %>",
            <% } %>
            <% if (regionType) { %>
                "regionType": "<%= regionType %>",
            <% } %>
            "selectedInitially": {
                // This first if is probably redundant, since the whitelist only lets LGA2011 through.
                <% if (geoType=="LGA2011") { %>
                    "REGIONTYPE": ["LGA2011"],
                <% } %>
                <% if (geoType=="SAx") { %>
                    "REGIONTYPE": ["SA4"],
                <% } %>
                <% if (measureSelectedInitially) { %>
                    "MEASURE": <%- JSON.stringify(measureSelectedInitially) %>,
                <% } %>
                "COB": ["1101"], // Start with Australia. There is no working total value.
                "DT": ["5"], // for series HF, start with average loan size.
                "STATE": ["1", "2", "3", "4", "5", "6", "7", "8"], // In the rare case where STATE is not aggregated over (eg. ABS_DEM_QIM), start with all selected.
                "ASGS_2011": ["1", "2", "3", "4", "5", "6", "7", "8"] // In the rare case where ASGS_2011 is not shown as a region (eg. ABS_DEM_QIM), start with all selected.
            }
            <% if (series) { %> // If "series" is not null, close the extra 2 grouping levels
            }] }]
            <% } %>
            <% if (bys) { %> // If "bys" is not null, close the extra grouping level
            }]
            <% } %>
            <% if (subgroup) { %> // If "subgroup" is not null, close the extra grouping levels
            }]
            <% } %>
        }
    ]
    <% if (series) { %> // If "series" is not null, close the extra top-level grouping level
    }]
    <% } %>
}
