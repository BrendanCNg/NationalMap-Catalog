// Pass optionally
// group:    The group name to include this in, eg. "Person".
// subgroup: An optional subgroup name, eg. "Education".
// name:     The name of the item, eg. "Number of Motor Vehicles".
// bys:      A string with the "by" variables, eg. "By Age by Sex".
// id:       The dataset id for the item, eg. "ABS_CENSUS2011_B29".
// geoType:  One of "SAx" (for SA1-4 datasets), "LGA2011" (for LGA_2011 datasets), "SA1_SA" (for South Aust SA1 datasets).
// hasState: Do we need to aggregate over the unnecessary STATE dimension?
// singleValuedDimensionIds: An array of dimensions which can only take a single value, eg. ["SPC"].
// sexId:    The sex dimension id - usually "MEASURE". Pass "" if none.
// ageId:    The age dimension id - usually "AGE" (eg. ABS_CENSUS2011_B45 puts AGE in MEASURE, sex in SEX). Pass "" if none.
// regionDimensionId: Required if the dimension id is not REGION, Eg. "ASGS_2011".
// regionType: The region type, eg. "aus".
// series:     Either "B" or "T" if this is B- or T- series Census data.
// measureWhitelist: Eg. Labour Force MEASURE has invalid entries such as "M" for "Migration:".
// measureTotalValueIds: Additional total fields in the MEASURE dimension, eg. for Census B12, "8" is Total dependent children.
{
    "name": "<%= group %>",
    "type": "group",
    "isOpen": false,
    "items": [
        {
            <% if (subgroup) { %> // If "subgroup" is not null, add another grouping level above "name"
                "name": "<%= subgroup %>",
                "type": "group",
                "isOpen": false,
                "items": [{
            <% } %>
            "name": "<%= name %>",
            <% if (bys) { %> // If "bys" is not null, add another grouping level under "name"
                "type": "group",
                "isOpen": false,
                "items": [{
                    "name": "<%= bys %>",
            <% } %>
            <% if (series) { %> // If it is a B or T series, add 2 grouping levels under "name" (for B/T and for LGA/SAx/SA_SA1s)
                "type": "group",
                "items": [{
                    "name": <%- include("sdmx-abs-BT-name", {"series": series}) %>,
                    "type": "group",
                    "items": [{
                        "name": <%- include("sdmx-abs-geo-name", {"geoType": geoType}) %>,
            <% } %>
            "type": "sdmx-json",
            "sortValues": "id",
            "showWarnings": false, // Eg. many of the DEATHS datasets include 0 or 50 in the list of state codes; do not raise a warning to user.
            "cleanFootnotes": true,
            "url": "http://stat.data.abs.gov.au/sdmx-json/data/<%= id %>",
            "description": <%- include("sdmx-abs-description", {"description": description, "id": id}) %>,
            <% if (hasState) { %>
               "aggregatedDimensionIds": ["STATE"],
            <% } %>
            <% if (singleValuedDimensionIds) { %>
                "singleValuedDimensionIds": <%- JSON.stringify(singleValuedDimensionIds) %>,
            <% } %>
            "totalValueIds": {
                "*": ["TOT", "LFTOT"],  // The dataflow for "COB" shows "TOTAL", but it isnt available in the data.
                <% if (sexId) { %>
                    "<%= sexId %>": ["3"],
                <% } %>
                <% if (ageId) { %>
                    "<%= ageId %>": ["TT", "O15"],
                <% } %>
                <% if (measureTotalValueIds) { %>
                    "MEASURE": <%- JSON.stringify(measureTotalValueIds) %>,
                <% } %>
                "SPC": ["TT"],
                "MTWP": ["1M", "2M", "3M"],
                "FMCF": ["CF", "1", "2", "3"],
                "POUR": ["TOT", "1", "2", "2_0", "2_11"],
                "UAI1P": ["TOT", "2", "2_S", "2_D"],
                "LFSP": ["TOT", "EMP", "UEMP"],
                "FAMILY_TYPE": ["6"], // ABS_FAMILY_PROJ
                "HH_TYPE": ["4"], // ABS_HH_PROV
                "LEN": ["99"], // HF, Household finance (lenders)
                "INFANT_AGE": ["IMTOT"],  // Infant ages, INFANTDEATHS_YEAROCCURENCE and INFANTDEATHS_REGISTRATIONYEAR
                "DLC_11NC": ["210", "205"],  // For ABS_LAND_COVER
                "ANZIC": ["TOTAL"],  // For ABS_LAMPS
                "LU_11NC": ["210", "205"],  // For ABS_LAND_USE
                "LENDER": ["99"], // For LENDING_INDUSTRY and LENDING_BY_PURPOSE
                "INDUSTRY": ["T"],  // For LENDING_INDUSTRY
                "PURPOSE": ["TOTAL_CF"],  // For LENDING_BY_PURPOSE
            },
            <% if (blacklist) { %>
                // Use a custom blacklist.
            "blacklist": <%- JSON.stringify(blacklist) %>,
            <% } else { %>
                // Use the generic blacklist. All these could actually now be moved into custom.
            "blacklist": {
                "COB": ["TOTAL", "1", "2", "3", "4", "5", "6", "7", "8", "9", "11", "12", "13", "14", "15", "16"],  // TOTAL and regional groups do not have any data
                "STATE": ["0"], // exclude Australia. Only needed in the rare case where STATE is not aggregated over (eg. ABS_DEM_QIM), but no Aust data is available.
                "ASGS_2011": ["0"], // exclude Australia. Only needed in the rare case where ASGS_2011 is not interpreted as a region dimension, as above.
                "AGE": ["1519"], // Labour force, LF, has this unusual code in AGE, along with 1599. There is no data in 1519, so exclude it.
                "DLC_11": ["T"],  // Claims to be dynamic land cover total for ABS_LAND_COVER, but not present.
                "MGT_PRACTICE": ["HEADER_.+"],  // None of the headers work.
                "LU_11": ["T"], // Not present in ABS_LAND_USE.
            },
            <% } %>
            "whitelist": {
                <% if (geoType && geoType.indexOf("LGA")===0) { %>
                    "REGIONTYPE": ["<%= geoType %>"],
                <% } %>
                <% if (measureWhitelist) { %>
                    "MEASURE": <%- JSON.stringify(measureWhitelist) %>,
                <% } %>
                "FMCF": ["TOT", "1", "2", "3", "9"],  // For B25. A hack to hide the detailed hierarchy, since we cannot cope with that yet.
                "STRD": ["TOT", "OPD", "1", "2", "3", "9", "Z", "UPD"], // For B31. Hack as above. Note for B36 this is in MEASURE.
                "LFSP": ["TOT", "EMP", "1", "2", "3", "4", "7", "Z", "UEMP"], // For B42. Hack to suppress some of the hierarchy.
                "MTWP": ["TOT", "1M", "2M", "3M", "001", "002", "003", "004", "005", "006", "007", "008", "009", "010", "011", "232", "TA", "BA", "B2", "233", "234", "Z"], // For B45. Hack to suppress some of the hierarchy.
                "<%= ageId %>": ["A[0-9]+", "T.*", "O.*"] // Only shows five-year ranges and totals, not individual years.
            },
            <% if (regionDimensionId) { %>
                "regionDimensionId": "<%= regionDimensionId %>",
            <% } %>
            <% if (regionType) { %>
                "regionType": "<%= regionType %>",
            <% } %>
            "selectedInitially": {
                // This first if is probably redundant, since the whitelist only lets LGA2011 through.
                <% if (geoType=="LGA2011") { %>
                    "REGIONTYPE": ["LGA2011"],
                <% } %>
                <% if (geoType=="SAx") { %>
                    "REGIONTYPE": ["SA4"],
                <% } %>
                <% if (measureSelectedInitially) { %>
                    "MEASURE": <%- JSON.stringify(measureSelectedInitially) %>,
                <% } %>
                "COB": ["1101"], // Start with Australia. There is no working total value.
                "DT": ["5"], // for series HF, start with average loan size.
                "STATE": ["1", "2", "3", "4", "5", "6", "7", "8"], // In the rare case where STATE is not aggregated over (eg. ABS_DEM_QIM), start with all selected.
                "ASGS_2011": ["1", "2", "3", "4", "5", "6", "7", "8"] // In the rare case where ASGS_2011 is not shown as a region (eg. ABS_DEM_QIM), start with all selected.
            }
            <% if (subgroup) { %> // If "subgroup" is not null, close the extra grouping levels
            }]
            <% } %>
            <% if (series) { %> // If "series" is not null, close the extra 2 grouping levels
            }] }]
            <% } %>
            <% if (bys) { %> // If "bys" is not null, close the extra grouping level
            }]
            <% } %>
        }
    ]
}
